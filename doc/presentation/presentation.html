<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Local Climate Zone Classification Using Random Forests</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ericka B. Smith" />
    <script src="libs/header-attrs-2.7/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Local Climate Zone Classification Using Random Forests
### Ericka B. Smith
### 3/9/2021

---




&lt;br&gt;
&lt;br&gt;
&lt;center&gt;
&lt;img src="UHI_index.png"&gt;
&lt;/center&gt;
???

- The Urban Heat Island effect is where urbanized areas are warmer than neighboring rural areas

- As the population worldwide increases and urbanizes this is a major concern,
because these heat islands cause increased energy consumption, elevated emissions of air pollutants
and greenhouse gasses, compromised human health and comfort, and impaired water quality.

- That's what you can see here in this generalized profile. Notice that our y-axis is degrees celsius, so these changes can be quite large.

- So, what can be done about them?
- Well we know that they are caused because urban built structures hold more heat than the structures and vegetation in surrounding areas.  You can see this in the profile. 

- Knowledge about microclimates within cities can be incredibly useful in mitigating this issue because it can give information about prospective sites for climate risk adaptation. 

- Unfortuately this information can be difficult to obtain.

- One way to find these microclimates is by classification of satellite imagery

---

&lt;center&gt;
&lt;img src="lcz.png" width="600"&gt;
&lt;br&gt;
&lt;font size = 2&gt;
Originally created by Stewart and Oke (2012), reproduced by Bechtel et al. (2017), licensed under CC-BY 4.0
&lt;/font&gt;
&lt;/center&gt;

???

Here you can see one of the predominant classification schemes for urban areas.

- On the outside circle are the urban classes, they range from 1 to 10 and include varying levels of built structures. It's roughly grouped into high-rises, mid-rises, low-rises, sparsely built, and heavy industry.

- On the inside circle are the natural classes, which range from A to G and include trees, bushes and low plants, bare soil rock or sand, and water.

- Moving forward I'll talk about the natural classes as classes 11-17 rather than A-G.

---

# Objective

* Hong Kong
* Yoo
* WUDAPT
* ntree


???

---

# The LCZ reference data

&lt;center&gt;
&lt;img src="../.././results/map_images/png_starting_polygons.png" alt="LCZ Reference Data" width="400" height="400"&gt;
&lt;/center&gt;


???


---

# The Landsat 8 data

&lt;table&gt;
&lt;tr&gt;&lt;td&gt;&lt;img src="../../results/tables/scenes.png"&gt;&lt;/td&gt; &lt;td&gt;
&lt;img src="../../results/map_images/png_bands.png" alt="Landsat Scene" width="400" height="400"&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

&lt;!-- &lt;p style="text-align:right;"&gt; --&gt;
&lt;!-- Methods --&gt;
&lt;!-- &lt;/p&gt; --&gt;

???

All 9 available bands of all 4 Landsat scenes amounted to 36 input variables. Each pixel is an observation,

---

&lt;!-- &lt;img src="../../results/tables/polygons.png" width=350&gt; --&gt;
&lt;img src="../../results/plots/traintest.png" width = 700&gt;

???

test is purple
train is yellow
---

# Decision Trees

???
think flow chart

---

# Impurity

Splits are typically evaluated by Gini impurity or entropy:

`$$\text{Gini Impurity} =\ I_G(t)\  = 1 - \sum_{i=1}^{C}p(i|t)^2$$`


Where: 
* `\(i\)` is a class in the predictor variable, ranging from 1 to `\(C\)`.
* `\(C\)` is the total number of classes represented for a particular node, `\(t\)`. 
* `\(p(i|t)\)` is the proportion of samples that belong to each `\(i\)`, for a particular node `\(t\)`.

???

---

# Random Forests vs. Decision Trees

???

talk about prediction some ?

---

# Out-of-Bag Error

???

---

# Tuning Parameters

???

---


# Accuracy Assessment

&lt;br&gt;
`$$\text{Overall Accuracy}= \text{OA}= \frac{\text{number of correctly classified reference sites}}{\text{total number of reference sites}}$$`
--

&lt;br&gt;
`$$F_1\text{ Score} = 2*\frac{UA*PA}{UA+PA}$$`
--

&lt;br&gt;
`$$UA(z)\ = \frac{\text{number of correctly identified pixels in class z}}{\text{total number of pixels identified as class z}}$$` 
--

&lt;br&gt;
`$$PA(z) = \frac{\text{number of correctly identified pixels in class z}}{\text{number of pixels truly in class z}}$$`

???

In line with the methods used in our reference paper and the remote sensing field, accuracy metrics will include the following:

`\(OA_{urb}\)` and `\(OA_{nat}\)` will be used, which are the same as overall `\(OA\)` but only includes the urban and natural classes, respectively.

`\(UA\)` is a measure of user's accuracy, which is also called precision or positive predictive value. `\(PA\)` is the measure of producer's accuracy, also known as recall or sensitivity. The harmonic mean of `\(UA\)` and `\(PA\)` gives the `\(F_1\)` score, which is a measure of the model's accuracy. An `\(F_1\)` Score closer to 1 indicates a model that has both low false positives and low false negatives.

---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="../../results/plots/png_ntree_5_to_500_line_plot.png" alt="OA Metrics when varying ntree from 5 to 500 in intervals of 5. Based on out-of-bag dataset."&gt;

???
# Results: OA for 5 to 500

The parameter for the number of trees was initially varied between 5 and 500 at intervals of 5. The resulting overall accuracy metrics indicate a leveling off around 125 trees (Figure 2). There's also a clear distinction between accuracy in urban vs. natural classes, with natural classes having a much higher overall accuracy.

---

&lt;img src="../../results/plots/png_ntree_5_to_500_facet_plot.png" height="625"&gt;

???

# Results: F-1 by Class 5 to 500

The variation between LCZ classes in F-1 score can be seen. As the number of trees in the random forest increases, F-1 score also increases, until around 100 trees. These metrics were calculated based on the out-of-bag dataset.

include larger plots for 500-2500 or just mention? Probably just mentio

---

&lt;br&gt;
&lt;br&gt;

&lt;img src="../../results/plots/png_test_set_validation_metrics_barplot_separated.png"&gt;

???

## Predicting on the Test Dataset

OA and F-1 metrics dropped dramatically upon applying the random forest to the test data (Figure 4).

Accuracy among random forest predictions for the test dataset varied widely, but was lower than expected for F-1 scores, which do not seem to agree with the OA metrics. Classes 2, 5, 8, and 14 have particularly low F-1 Scores

---
&lt;br&gt;
&lt;br&gt;
&lt;img src="../../results/plots/png_importance_barplot_ntree125.png"&gt;

???

There is not a clear pattern in Mean Decrease for Gini Impurity between the different bands and scenes, though there is some indication that bands in scene 4 were particularly effective as predictors.

---

## Creating the Full Prediction

&lt;table&gt;
&lt;tr&gt;&lt;td&gt;&lt;img src="../../results/map_images/png_satellite_baselayer.png" height=350&gt;&lt;/td&gt; &lt;td&gt;&lt;img src="../../results/map_images/png_bands.png" height=350&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;th&gt;Google Maps Satellite Imagery&lt;/th&gt;&lt;th&gt;Landsat 8 Scene&lt;/th&gt;
&lt;/table&gt;

???
On the left is a google maps baselayer of the area of interest
On the right is the same baselayer with one Landsat 8 scene overlayed.

---

## Creating the Full Prediction
&lt;center&gt;
&lt;img src="../../results/map_images/png_lcz_with_satellite.png" height=425&gt;&lt;img src="../../results/map_images/png_class_legend_vertical.png" width=205&gt;
&lt;/center&gt;
???

Here is the entire area of interest classified into local climate zones. 

---

# Conclusion

Overall Results:
* Low accuracy for prediction on the test data, in comparison to the out-of-bag data
* High OA values can mask low F1 scores within classes

--

&lt;br&gt;
Limitations:
* Reference polygons on account for ~3% of the Area of Interest
* Time constraints
--

&lt;br&gt;
Future Work:
* Multiple tuning parameters &amp; Interactions between them
* Quantifying "how much" ground truth data is enough

???

---

# Questions?
 
All code and higher resolution images for this project can be found on GitHub at &lt;https://github.com/erickabsmith/masters-project-lcz-classification&gt;.


???

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
